---
title: "p8105_hw2_jm5916"
author: "Juhi Mattekatt"
date: "2025-09-30"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

# Problem 1
```{r problem1_setup, message = FALSE}
#read data in 
pols_month <- read_csv(file = "./fivethirtyeight_datasets/pols-month.csv")
unemployment <- read_csv(file = "./fivethirtyeight_datasets/unemployment.csv")
snp <- read_csv(file = "./fivethirtyeight_datasets/snp.csv")

#check datasets
names(pols_month)
names(unemployment)
names(snp)
```
I've imported the three datasets in using relative paths. The files are in the fivethirtyeight_datasets folder within my subdirectory for this homework. I viewed the data (in console) and checked to see how the names were formatted.

```{r problem1_clean_datasets}
#clean pols_month for merging
pols_month_merge <- pols_month %>% 
  separate(mon, into = c("year", "month", "day"), sep = "-") %>% #break up the variable mon
  mutate(
    year = as.integer(year), #make year, month, and day integer variables, use as.integer to prevent dropping of leading 0s
    month = as.integer(month), 
    day = as.integer(day),
    month = month.name[month], #replace month number with month name
    president = case_when( #use mutate and case when to create new variable president
      prez_dem == 1 & prez_gop == 0 ~ "dem", 
      prez_gop == 1 & prez_dem == 0 ~ "gop") ) %>% 
  select(-prez_dem, -prez_gop, -day) %>%  #remove columns
  arrange(year, month) #arrange by year and month

#clean snp for merging 
snp_merge <- snp %>%  
  separate(date, into = c("month", "day", "year"), sep = "/") %>% #break up the variable date
  mutate( #mutate to change values
    year = case_when( #case when to add start of year to values in year
      0 <= as.numeric(year) & as.numeric(year) <= 15 ~ paste0("20", year), 
      50 <= as.numeric(year) & as.numeric(year) <= 99 ~ paste0("19", year)),
    year = as.numeric(year), #make year, month, and day integer variables
    month = as.numeric(month), 
    day = as.numeric(day),
    month = month.name[month]) %>% #replace month number with month name  
  select(-day) %>% #remove columns 
  arrange(year, month) %>% 
  relocate(year, month) #move year and month to front

#clean unemployment for merging
unemployment_merge <- unemployment %>%  
  pivot_longer( #pivot from wide to long format
    Jan:Dec,
    names_to = "month_abb", #make new variable month_abb for abbreviated months
    values_to = "%_unemployment") %>% 
  rename(year = Year) %>% #make sure year isn't capitalized
  mutate( #make new variable month with full month names to match other datasets
    month = month.name[match(month_abb, month.abb)]) %>% #convert abbreviated to full name
  arrange(year, month) %>% 
  relocate(year, month) %>% 
  select(-month_abb) #remove abbreviated month column
```
I've created 3 new datasets (I kept the old datasets as is in case I made any mistakes while cleaning the data) to make the keys I'm joining by compatible with each other.
```{r problem1_merge}
#left join snp into pols_month
pols_snp = left_join(pols_month_merge, snp_merge, by = c("year", "month"))

#left join unemployment into snp_pols
pols_snp_unemployment = left_join(pols_snp, unemployment_merge, by = c("year", "month"))
```

## Explanation 
The dataset `pols_month` contains information on the number of national politicians (president, senators, governors, and representatives) who are democratic or republican at some time point. `snp` indicates the closing values of the S&P stock index at a given date, and `unemployment` identifies % unemployment for every month of a given year. My final dataset `pols_snp_unemployment` has `r nrow(pols_snp_unemployment)` rows and `r ncol(pols_snp_unemployment)` columns and combines all the information from the above datasets for the years and months described in `pols_month`. The years range from `r min(pols_snp_unemployment$year)` to `r max(pols_snp_unemployment$year)`, and key variables include `president`, `close`, and `%_unemployment`. 

# Problem 2
```{r problem2_setup, message = FALSE}

```
